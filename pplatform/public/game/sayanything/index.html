<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
 <!-- Copyright (C) 2015 Christoph Kutza -->
    <title>Say Anything</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      .stateview { background: #aaa;margin-bottom: 50px; padding: 10px;}
      .view { background: #aff; }
      .controller { background: #ffa;}
      .judgecontroller { background: #faf;}
      .hostcontroller { background: #faf;}
      .judgeName {color: red;}
      
      
    </style>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
  <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
  <script src="../../netgroupclient.js"></script>
  <script src="../../pplatformclient.js"></script>
  <script src="sayanything.js"></script>
  </head>
  <body>
      <h1> Say Anything </h1>
              <div class="stateview" id="debug">
            <h2>Debugview</h2>
            Grey: A certain state in the game. Visible for View and Controller<br>
            <div class="view">
                Cyan: Bigview<br>
            </div>
            <div class="controller">
                Yellow: Controller<br>
            </div>
            <div class="hostcontroller">
                Purple: Judge or Hostcontroller<br>
            </div>
        </div>
        <div class="stateview" id="WaitForStart">
            <h2>State: WaitForStart</h2>
            <div class="view">
                View waiting for game to start
                <p>
                Players:
                    <ul id="playerlist">
                    </ul>
                </p>
            </div>
            <div class="controller">
                Waiting for Host
            </div>
            <div class="hostcontroller">
                <button onclick="startGame()">Start Game</button>
                <button onclick="leaveGame()">Leave Game</button>
            </div>
        </div>
        
        <div class="stateview" id="Questioning">
            <h2>State: Questioning</h2>
            <div class="view">
                
                <p><span class="judgeName">Player</span> is choosing a question.</p>
                <span class="timeLeft">30</span>
            </div>
            <div class="controller">
                <p> Waiting for <span class="judgeName">Player</span> to choose a question.</p>
            </div>
            <div class="judgecontroller">
                <div class="questionList">
                    <label> <input type="radio" name="questionList" id="questionListQ1" value="Q1"><span id="questionListQ1Label">Q1</span></label> <br>
                    <label> <input type="radio" name="questionList" id="questionListQ2" value="Q2"><span id="questionListQ2Label">Q2</span></label> <br>
                    <label> <input type="radio" name="questionList" id="questionListQ3" value="Q3"><span id="questionListQ3Label">Q3</span></label> <br>
                    <label> <input type="radio" name="questionList" id="questionListQ4" value="Q4"><span id="questionListQ4Label">Q4</span></label> <br>
                    <label> <input type="radio" name="questionList" id="questionListQ5" value="custom"><input type="text" id="questionCustom"></label> <br>
                    
                    <button class="confirm" onclick="questionListConfirm()">Confirm Selection</button>
                </div>
            </div>
        </div>
        
        <div class="stateview" id="Answering">
            <h2>State: Answering</h2>
            <div class="view">
                <p><span class="judgeName">Player</span> asks: </p>
                <p class="chosenQuestion">Chosen Question?</p>
                <span class="timeLeft">30</span>
            </div>
            <div class="controller">
                <p>Write your Answer</p>
                <input type="text" id="answer"> </input>
                <button class="confirm" onclick="answerConfirm()">Confirm</button>
            </div>
            <div class="judgecontroller">
                <p>Waiting for players to answer your question.</p>
            </div>
        </div>
        
        <div class="stateview" id="ShowAnswers">
            <h2>State: Show Answers</h2>
            <div class="view">
                <div class="answerList">
                    
                    <label class="A1"><span class="answer">A1</span></label> <br>
                    <label class="A2"><span class="answer">A2</span></label> <br>
                    <label class="A3"><span class="answer">A3</span></label> <br>
                    <label class="A4"><span class="answer">A4</span></label> <br>
                    <label class="A5"><span class="answer">A5</span></label> <br>
                    <label class="A6"><span class="answer">A6</span></label> <br>
                    <label class="A7"><span class="answer">A7</span></label> <br>
                    <label class="A8"><span class="answer">A8</span></label> <br>
                    <label class="A9"><span class="answer">A9</span></label> <br>
                    <label class="A10"><span class="answer">A10</span></label> <br>
                    
                </div>
            </div>
            <div class="controller">
                Wait for all answers to be presented.
            </div>
            <div class="judgecontroller">
                Wait for all answers to be presented.
            </div>
        </div>
        
        <div class="stateview" id="Judging">
            <h2>State: Judging</h2>
            <div class="view">
                
                <p><span class="judgeName">Player</span> is in deliberation.</p>
                <span class="timeLeft">60</span>
            </div>
            <div class="controller">
                Waiting for judge to pick their favorite.
            </div>
            <div class="judgecontroller">
                Choose Your Favorite
                
                <div class="judgeList">
                    <label class="A1"> <input type="radio" name="judgingRadio" value="1" class="CB"><span class="answer">A1</span></label> <br>
                    <label class="A2"> <input type="radio" name="judgingRadio" value="2" class="CB"><span class="answer">A2</span></label> <br>
                    <label class="A3"> <input type="radio" name="judgingRadio" value="3" class="CB"><span class="answer">A3</span></label> <br>
                    <label class="A4"> <input type="radio" name="judgingRadio" value="4" class="CB"><span class="answer">A4</span></label> <br>
                    <label class="A5"> <input type="radio" name="judgingRadio" value="5" class="CB"><span class="answer">A5</span></label> <br>
                    <label class="A6"> <input type="radio" name="judgingRadio" value="6" class="CB"><span class="answer">A6</span></label> <br>
                    <label class="A7"> <input type="radio" name="judgingRadio" value="7" class="CB"><span class="answer">A7</span></label> <br>
                    <label class="A8"> <input type="radio" name="judgingRadio" value="8" class="CB"><span class="answer">A8</span></label> <br>
                    <label class="A9"> <input type="radio" name="judgingRadio" value="9" class="CB"><span class="answer">A9</span></label> <br>
                    <label class="A10"> <input type="radio" name="judgingRadio" value="10" class="CB"><span class="answer">A10</span></label> <br>
                    <button class="confirm" onclick="judgingConfirm()">Confirm Selection</button>
                </div>
                <div class="answerList">
                </div>
            </div>
        </div>
        
        <div class="stateview" id="Voting">
            <h2>State: Voting</h2>
            <div class="view">
                    <div class="A1"> <span class="answer">A1</span> <br><span class="votes"> </span> </div> <br>
                    <div class="A2"> <span class="answer">A2</span> <br><span class="votes"> </span> </div> <br>
                    <div class="A3"> <span class="answer">A3</span> <br><span class="votes"> </span> </div> <br>
                    <div class="A4"> <span class="answer">A4</span> <br><span class="votes"> </span> </div> <br>
                    <div class="A5"> <span class="answer">A5</span> <br><span class="votes"> </span> </div> <br>
                    <div class="A6"> <span class="answer">A6</span> <br><span class="votes"> </span> </div> <br>
                    <div class="A7"> <span class="answer">A7</span> <br><span class="votes"> </span> </div> <br>
                    <div class="A8"> <span class="answer">A8</span> <br><span class="votes"> </span> </div> <br>
                    <div class="A9"> <span class="answer">A9</span> <br><span class="votes"> </span> </div> <br>
                    <div class="A10"> <span class="answer">A10</span> <br><span class="votes"> </span> </div> <br>
                    
            </div>
            <div class="controller">
                <div class="voteList">
                     <span class="A1"> <input type="radio" name="votingRadio1" value="1" class="A1CB"><label> <input type="radio" name="votingRadio2" value="1" class="CB"><span class="answer">A1</span></label></span> <br>
                     <span class="A2"> <input type="radio" name="votingRadio1" value="1" class="A1CB"><label> <input type="radio" name="votingRadio2" value="2" class="CB"><span class="answer">A2</span></label></span> <br>
                     <span class="A3"> <input type="radio" name="votingRadio1" value="1" class="A1CB"><label> <input type="radio" name="votingRadio2" value="3" class="CB"><span class="answer">A3</span></label></span> <br>
                     <span class="A4"> <input type="radio" name="votingRadio1" value="1" class="A1CB"><label> <input type="radio" name="votingRadio2" value="4" class="CB"><span class="answer">A4</span></label></span> <br>
                     <span class="A5"> <input type="radio" name="votingRadio1" value="1" class="A1CB"><label> <input type="radio" name="votingRadio2" value="5" class="CB"><span class="answer">A5</span></label></span> <br>
                     <span class="A6"> <input type="radio" name="votingRadio1" value="1" class="A1CB"><label> <input type="radio" name="votingRadio2" value="6" class="CB"><span class="answer">A6</span></label></span> <br>
                     <span class="A7"> <input type="radio" name="votingRadio1" value="1" class="A1CB"><label> <input type="radio" name="votingRadio2" value="7" class="CB"><span class="answer">A7</span></label></span> <br>
                     <span class="A8"> <input type="radio" name="votingRadio1" value="1" class="A1CB"><label> <input type="radio" name="votingRadio2" value="8" class="CB"><span class="answer">A8</span></label></span> <br>
                     <span class="A9"> <input type="radio" name="votingRadio1" value="1" class="A1CB"><label> <input type="radio" name="votingRadio2" value="9" class="CB"><span class="answer">A9</span></label></span> <br>
                     <span class="A10"> <input type="radio" name="votingRadio1" value="1" class="A1CB"><label> <input type="radio" name="votingRadio2" value="10" class="CB"><span class="answer">A10</span></label></span> <br>
                     <button class="confirm" onclick="votingConfirm()">Confirm Selection</button>
                </div>
            </div>
            <div class="judgecontroller">
                Wait for players to place votes
            </div>
        </div>
        
        <div class="stateview" id="ShowWinner">
            <h2>State: ShowWinner</h2>
            <div class="view">
                <div class="A1"> <span class="vplayer">player 1</span>: <br><span class="answer">A1</span> <br><span class="votes"> </span></div> <br>
                <div class="A2"> <span class="vplayer">player 2</span>: <br><span class="answer">A2</span> <br><span class="votes"> </span></div> <br>
                <div class="A3"> <span class="vplayer">player 3</span>: <br><span class="answer">A3</span> <br><span class="votes"> </span></div> <br>
                <div class="A4"> <span class="vplayer">player 4</span>: <br><span class="answer">A4</span> <br><span class="votes"> </span></div> <br>
                <div class="A5"> <span class="vplayer">player 5</span>: <br><span class="answer">A5</span> <br><span class="votes"> </span></div> <br>
                <div class="A6"> <span class="vplayer">player 6</span>: <br><span class="answer">A6</span> <br><span class="votes"> </span></div> <br>
                <div class="A7"> <span class="vplayer">player 7</span>: <br><span class="answer">A7</span> <br><span class="votes"> </span></div> <br>
                <div class="A8"> <span class="vplayer">player 8</span>: <br><span class="answer">A8</span> <br><span class="votes"> </span></div> <br>
                <div class="A9"> <span class="vplayer">player 9</span>: <br><span class="answer">A9</span> <br><span class="votes"> </span></div> <br>
                <div class="A10"> <span class="vplayer">player 10</span>: <br><span class="answer">A10</span> <br><span class="votes"> </span></div> <br>
            </div>
            <div class="controller">
            </div>
            <div class="judgecontroller">
            </div>
        </div>
        
        <div class="stateview" id="ShowScore">
            <h2>State: ShowScore</h2>
            <div class="view">
            </div>
            <div class="controller">
            </div>
            <div class="judgecontroller">
            </div>
        </div>
        
        
<script>

    //ui handlers. maps ui to logic
    function startGame()
    {
        
        gPlatform.sendMessage(SayAnything.Message.StartGame.TAG, new SayAnything.Message.StartGame());
    }
    
    function leaveGame()
    {
        gPlatform.enterGame("./gamelist.html");
    }


    //fills the list of answers into the GUI elements
    function answerListFill(lSharedData)
    {
         $(".chosenQuestion").empty().append(lSharedData.question);
        
        //this loop will go through all given answers and fill the UI with data (answers, id's of checkboxes/radio buttons, votes for the answers, player names that received and gave votes)
        var counter = 1;
        for(var userId in lSharedData.answers)
        {
        //answers
            var parentElement = ".A" + counter;
            //Label is in all constructs the parent -> make it visible for this answer
            $(parentElement).attr("hidden", false);

            //A1, A2 and so on are used for spans that are suppose to contain the answers -> add them
            $(parentElement + " .answer").empty().append(lSharedData.answers[userId]);

            //set the id in the value attribute of checkboxes. we use that later to find out who the vote/judge belongs to
            $(parentElement + " .CB").val(userId);

        //votes
            var votes = lSharedData.getVotes(userId);
            var votesParentTag = $(parentElement + " .votes");
            votesParentTag.empty();
            votesParentTag.append("Voted by ");
            for(var i = 0; i < votes.length; i++)
            {
                votesParentTag.append("player " + votes[i] + " ");
            }
            
            //if this is the selected answer by the judge -> add the judge mark
            if(lSharedData.state == SayAnything.GameState.ShowWinner && userId == lSharedData.judgeAnswerId)
            {
                votesParentTag.append(" <b>" + "player " + lSharedData.judgeUserId + "</b>");
            }
            $(parentElement + " .vplayer").empty().append("player " + userId);

            counter++;
        }
        
        
        //hide all UI slots that aren't filled with answers
        for(var i = counter; i <= 10; i++) //10 = max player numbers
        {
            var parentElement = ".A" + i;
            //Label is in all constructs the parent -> make it visible for this answer
            $(parentElement).attr("hidden", true);
        }
    }
    
    
    //test data
    var testSharedData = new SayAnything.Data.Shared();
    testSharedData.judgeUserId = 2;
    testSharedData.question = "Random question asked by user 2";
    testSharedData.answers[5] = "answer of user 5";
    testSharedData.answers[6] = "answer of user 6";
    testSharedData.answers[7] = "answer of user 7";
    testSharedData.votes[5] = [6, 6];
    testSharedData.votes[6] = [5, 7];
    testSharedData.votes[7] = [7, 5];
    testSharedData.judgedAnswerId = 5;
    answerListFill(testSharedData);
    
    //answerListFill({1:"testanswer", 4:"testanswer2"});
    function questionListFill(lQ1, lQ2, lQ3, lQ4)
    {
        
        
        $("#questionListQ1").val(lQ1);
        $("#questionListQ2").val(lQ2);
        $("#questionListQ3").val(lQ3);
        $("#questionListQ4").val(lQ4);
        $("#questionListQ1Label").empty().append(lQ1);
        $("#questionListQ2Label").empty().append(lQ2);
        $("#questionListQ3Label").empty().append(lQ3);
        $("#questionListQ4Label").empty().append(lQ4);
    }
    //testing:
    //questionListFill("QU1", "QU2", "QU3", "QU4");
    function questionListConfirm()
    {
        var question = $("input[name=questionList]:checked").val();
        if(question == "custom")
        {
            question = $("#questionCustom").val();
        }
        //alert(question);
        gPlatform.sendMessage(SayAnything.Message.Question.TAG, new SayAnything.Message.Question(question));
    }
    
    function answerConfirm()
    {
        var answer = $("#answer").val();
        //alert(answer);
        
        
        gPlatform.sendMessage(SayAnything.Message.Answer.TAG, new SayAnything.Message.Answer(answer));
    }
    
    function judgingConfirm()
    {
        var playerid = $("input[name=judgingRadio]:checked").val();
        gPlatform.sendMessage(SayAnything.Message.Judge.TAG, new SayAnything.Message.Judge(playerid));
    }
    
    function votingConfirm()
    {
         var playerid1 = $("input[name=votingRadio1]:checked").val();
         var playerid2 = $("input[name=votingRadio2]:checked").val();
        gPlatform.sendMessage(SayAnything.Message.Vote.TAG, new SayAnything.Message.Vote(playerid1, playerid2));
    }
    InitGame();
    
    
</script>
  </body>
</html>